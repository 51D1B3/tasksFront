import{r}from"./router-B1sHOYRp.js";import{t as c}from"./index-BERK0uPc.js";const j=(g={})=>{const[a,u]=r.useState([]),[m,d]=r.useState(!1),[f,p]=r.useState(null),[o,k]=r.useState(g),[T,w]=r.useState({total:0,page:1,limit:10,pages:0}),l=r.useCallback(async(e={})=>{d(!0),p(null);try{const s=await c.getTasks({...o,...e});u(s.data),w(s.meta)}catch(s){p(s.response?.data?.message||"Erreur lors du chargement des tâches")}finally{d(!1)}},[o]),y=r.useCallback(async e=>{try{const s=await c.createTask(e);return await l(),s}catch(s){throw new Error(s.response?.data?.message||"Erreur lors de la création de la tâche")}},[l]),i=r.useCallback(async(e,s)=>{try{console.log("Tentative de mise à jour de la tâche:",{id:e,taskData:s});const t=await c.updateTask(e,s);console.log("Réponse du serveur:",t);const n=t;return u(C=>C.map(h=>h._id===e?n:h)),n}catch(t){throw console.error("Erreur complète updateTask:",t),console.error("Réponse d'erreur:",t.response),console.error("Status:",t.response?.status),console.error("Data:",t.response?.data),new Error(t.response?.data?.message||"Erreur lors de la mise à jour de la tâche")}},[]),E=r.useCallback(async e=>{try{await c.deleteTask(e),u(s=>s.filter(t=>t._id!==e))}catch(s){throw new Error(s.response?.data?.message||"Erreur lors de la suppression de la tâche")}},[]),S=r.useCallback(async(e,s)=>{let t;switch(s){case"todo":t="in_progress";break;case"in_progress":t="done";break;case"done":t="todo";break;default:t="todo"}try{const n=await i(e,{status:t});return t==="done"?alert("✅ Tâche marquée comme terminée !"):t==="in_progress"?alert("▶ Tâche commencée !"):t==="todo"&&alert("↶ Tâche rouverte !"),n}catch(n){throw n}},[i]),b=r.useMemo(()=>a.filter(e=>!(o.status&&e.status!==o.status||o.priority&&e.priority!==o.priority)),[a,o]),_=r.useMemo(()=>({total:a.length,todo:a.filter(e=>e.status==="todo").length,inProgress:a.filter(e=>e.status==="in_progress").length,done:a.filter(e=>e.status==="done").length,high:a.filter(e=>e.priority==="high").length,medium:a.filter(e=>e.priority==="medium").length,low:a.filter(e=>e.priority==="low").length}),[a]);return r.useEffect(()=>{l()},[l]),{tasks:b,allTasks:a,loading:m,error:f,meta:T,filters:o,setFilters:k,fetchTasks:l,createTask:y,updateTask:i,deleteTask:E,toggleTaskStatus:S,taskStats:_}};export{j as u};
